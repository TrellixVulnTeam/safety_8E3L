{"ast":null,"code":"// this is called when an ERESOLVE error is caught in the error-handler,\n// or when there's a log.warn('eresolve', msg, explanation), to turn it\n// into a human-intelligible explanation of what's wrong and how to fix.\n//\n// TODO: abstract out the explainNode methods into a separate util for\n// use by a future `npm explain <path || spec>` command.\nconst npm = require('../npm.js');\n\nconst {\n  writeFileSync\n} = require('fs');\n\nconst {\n  resolve\n} = require('path');\n\nconst {\n  explainEdge,\n  explainNode,\n  printNode\n} = require('./explain-dep.js'); // expl is an explanation object that comes from Arborist.  It looks like:\n// Depth is how far we want to want to descend into the object making a report.\n// The full report (ie, depth=Infinity) is always written to the cache folder\n// at ${cache}/eresolve-report.txt along with full json.\n\n\nconst explainEresolve = (expl, color, depth) => {\n  const {\n    edge,\n    current,\n    peerConflict,\n    currentEdge\n  } = expl;\n  const out = [];\n  if (edge.from && edge.from.whileInstalling) out.push('While resolving: ' + printNode(edge.from.whileInstalling, color)); // it \"should\" be impossible for an ERESOLVE explanation to lack both\n  // current and currentEdge, but better to have a less helpful error\n  // than a crashing failure.\n\n  if (current) out.push('Found: ' + explainNode(current, depth, color));else if (currentEdge) out.push('Found: ' + explainEdge(currentEdge, depth, color));\n  out.push('\\nCould not resolve dependency:\\n' + explainEdge(edge, depth, color));\n\n  if (peerConflict) {\n    const heading = '\\nConflicting peer dependency:';\n    const pc = explainNode(peerConflict, depth, color);\n    out.push(heading + ' ' + pc);\n  }\n\n  return out.join('\\n');\n}; // generate a full verbose report and tell the user how to fix it\n\n\nconst report = (expl, depth = 4) => {\n  const fullReport = resolve(npm.cache, 'eresolve-report.txt');\n  const orNoStrict = expl.strictPeerDeps ? '--no-strict-peer-deps, ' : '';\n  const fix = `Fix the upstream dependency conflict, or retry\nthis command with ${orNoStrict}--force, or --legacy-peer-deps\nto accept an incorrect (and potentially broken) dependency resolution.`;\n  writeFileSync(fullReport, `# npm resolution error report\n\n${new Date().toISOString()}\n\n${explainEresolve(expl, false, Infinity)}\n\n${fix}\n\nRaw JSON explanation object:\n\n${JSON.stringify(expl, null, 2)}\n`, 'utf8');\n  return explainEresolve(expl, npm.color, depth) + `\\n\\n${fix}\\n\\nSee ${fullReport} for a full report.`;\n}; // the terser explain method for the warning when using --force\n\n\nconst explain = (expl, depth = 2) => explainEresolve(expl, npm.color, depth);\n\nmodule.exports = {\n  explain,\n  report\n};","map":{"version":3,"sources":["/Users/kaelen/nsc-mds/node_modules/npm/lib/utils/explain-eresolve.js"],"names":["npm","require","writeFileSync","resolve","explainEdge","explainNode","printNode","explainEresolve","expl","color","depth","edge","current","peerConflict","currentEdge","out","from","whileInstalling","push","heading","pc","join","report","fullReport","cache","orNoStrict","strictPeerDeps","fix","Date","toISOString","Infinity","JSON","stringify","explain","module","exports"],"mappings":"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","sourcesContent":["// this is called when an ERESOLVE error is caught in the error-handler,\n// or when there's a log.warn('eresolve', msg, explanation), to turn it\n// into a human-intelligible explanation of what's wrong and how to fix.\n//\n// TODO: abstract out the explainNode methods into a separate util for\n// use by a future `npm explain <path || spec>` command.\n\nconst npm = require('../npm.js')\nconst { writeFileSync } = require('fs')\nconst { resolve } = require('path')\nconst { explainEdge, explainNode, printNode } = require('./explain-dep.js')\n\n// expl is an explanation object that comes from Arborist.  It looks like:\n// Depth is how far we want to want to descend into the object making a report.\n// The full report (ie, depth=Infinity) is always written to the cache folder\n// at ${cache}/eresolve-report.txt along with full json.\nconst explainEresolve = (expl, color, depth) => {\n  const { edge, current, peerConflict, currentEdge } = expl\n\n  const out = []\n  if (edge.from && edge.from.whileInstalling)\n    out.push('While resolving: ' + printNode(edge.from.whileInstalling, color))\n\n  // it \"should\" be impossible for an ERESOLVE explanation to lack both\n  // current and currentEdge, but better to have a less helpful error\n  // than a crashing failure.\n  if (current)\n    out.push('Found: ' + explainNode(current, depth, color))\n  else if (currentEdge)\n    out.push('Found: ' + explainEdge(currentEdge, depth, color))\n\n  out.push('\\nCould not resolve dependency:\\n' +\n    explainEdge(edge, depth, color))\n\n  if (peerConflict) {\n    const heading = '\\nConflicting peer dependency:'\n    const pc = explainNode(peerConflict, depth, color)\n    out.push(heading + ' ' + pc)\n  }\n\n  return out.join('\\n')\n}\n\n// generate a full verbose report and tell the user how to fix it\nconst report = (expl, depth = 4) => {\n  const fullReport = resolve(npm.cache, 'eresolve-report.txt')\n\n  const orNoStrict = expl.strictPeerDeps ? '--no-strict-peer-deps, ' : ''\n  const fix = `Fix the upstream dependency conflict, or retry\nthis command with ${orNoStrict}--force, or --legacy-peer-deps\nto accept an incorrect (and potentially broken) dependency resolution.`\n\n  writeFileSync(fullReport, `# npm resolution error report\n\n${new Date().toISOString()}\n\n${explainEresolve(expl, false, Infinity)}\n\n${fix}\n\nRaw JSON explanation object:\n\n${JSON.stringify(expl, null, 2)}\n`, 'utf8')\n\n  return explainEresolve(expl, npm.color, depth) +\n    `\\n\\n${fix}\\n\\nSee ${fullReport} for a full report.`\n}\n\n// the terser explain method for the warning when using --force\nconst explain = (expl, depth = 2) => explainEresolve(expl, npm.color, depth)\n\nmodule.exports = {\n  explain,\n  report,\n}\n"]},"metadata":{},"sourceType":"script"}