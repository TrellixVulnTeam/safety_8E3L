{"ast":null,"code":"const {\n  explainNode\n} = require('./utils/explain-dep.js');\n\nconst completion = require('./utils/completion/installed-deep.js');\n\nconst Arborist = require('@npmcli/arborist');\n\nconst npa = require('npm-package-arg');\n\nconst semver = require('semver');\n\nconst {\n  relative,\n  resolve\n} = require('path');\n\nconst validName = require('validate-npm-package-name');\n\nconst BaseCommand = require('./base-command.js');\n\nclass Explain extends BaseCommand {\n  static get description() {\n    return 'Explain installed packages';\n  }\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n\n\n  static get name() {\n    return 'explain';\n  }\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n\n\n  static get usage() {\n    return ['<folder | specifier>'];\n  }\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n\n\n  async completion(opts) {\n    return completion(this.npm, opts);\n  }\n\n  exec(args, cb) {\n    this.explain(args).then(() => cb()).catch(cb);\n  }\n\n  async explain(args) {\n    if (!args.length) throw this.usage;\n    const arb = new Arborist({\n      path: this.npm.prefix,\n      ...this.npm.flatOptions\n    });\n    const tree = await arb.loadActual();\n    const nodes = new Set();\n\n    for (const arg of args) {\n      for (const node of this.getNodes(tree, arg)) nodes.add(node);\n    }\n\n    if (nodes.size === 0) throw `No dependencies found matching ${args.join(', ')}`;\n    const expls = [];\n\n    for (const node of nodes) {\n      const {\n        extraneous,\n        dev,\n        optional,\n        devOptional,\n        peer,\n        inBundle\n      } = node;\n      const expl = node.explain();\n      if (extraneous) expl.extraneous = true;else {\n        expl.dev = dev;\n        expl.optional = optional;\n        expl.devOptional = devOptional;\n        expl.peer = peer;\n        expl.bundled = inBundle;\n      }\n      expls.push(expl);\n    }\n\n    if (this.npm.flatOptions.json) this.npm.output(JSON.stringify(expls, null, 2));else {\n      this.npm.output(expls.map(expl => {\n        return explainNode(expl, Infinity, this.npm.color);\n      }).join('\\n\\n'));\n    }\n  }\n\n  getNodes(tree, arg) {\n    // if it's just a name, return packages by that name\n    const {\n      validForOldPackages: valid\n    } = validName(arg);\n    if (valid) return tree.inventory.query('name', arg); // if it's a location, get that node\n\n    const maybeLoc = arg.replace(/\\\\/g, '/').replace(/\\/+$/, '');\n    const nodeByLoc = tree.inventory.get(maybeLoc);\n    if (nodeByLoc) return [nodeByLoc]; // maybe a path to a node_modules folder\n\n    const maybePath = relative(this.npm.prefix, resolve(maybeLoc)).replace(/\\\\/g, '/').replace(/\\/+$/, '');\n    const nodeByPath = tree.inventory.get(maybePath);\n    if (nodeByPath) return [nodeByPath]; // otherwise, try to select all matching nodes\n\n    try {\n      return this.getNodesByVersion(tree, arg);\n    } catch (er) {\n      return [];\n    }\n  }\n\n  getNodesByVersion(tree, arg) {\n    const spec = npa(arg, this.npm.prefix);\n    if (spec.type !== 'version' && spec.type !== 'range') return [];\n    return tree.inventory.filter(node => {\n      return node.package.name === spec.name && semver.satisfies(node.package.version, spec.rawSpec);\n    });\n  }\n\n}\n\nmodule.exports = Explain;","map":{"version":3,"sources":["/Users/kaelen/nsc-mds/node_modules/npm/lib/explain.js"],"names":["explainNode","require","completion","Arborist","npa","semver","relative","resolve","validName","BaseCommand","Explain","description","name","usage","opts","npm","exec","args","cb","explain","then","catch","length","arb","path","prefix","flatOptions","tree","loadActual","nodes","Set","arg","node","getNodes","add","size","join","expls","extraneous","dev","optional","devOptional","peer","inBundle","expl","bundled","push","json","output","JSON","stringify","map","Infinity","color","validForOldPackages","valid","inventory","query","maybeLoc","replace","nodeByLoc","get","maybePath","nodeByPath","getNodesByVersion","er","spec","type","filter","package","satisfies","version","rawSpec","module","exports"],"mappings":"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","sourcesContent":["const { explainNode } = require('./utils/explain-dep.js')\nconst completion = require('./utils/completion/installed-deep.js')\nconst Arborist = require('@npmcli/arborist')\nconst npa = require('npm-package-arg')\nconst semver = require('semver')\nconst { relative, resolve } = require('path')\nconst validName = require('validate-npm-package-name')\nconst BaseCommand = require('./base-command.js')\n\nclass Explain extends BaseCommand {\n  static get description () {\n    return 'Explain installed packages'\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get name () {\n    return 'explain'\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get usage () {\n    return ['<folder | specifier>']\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  async completion (opts) {\n    return completion(this.npm, opts)\n  }\n\n  exec (args, cb) {\n    this.explain(args).then(() => cb()).catch(cb)\n  }\n\n  async explain (args) {\n    if (!args.length)\n      throw this.usage\n\n    const arb = new Arborist({ path: this.npm.prefix, ...this.npm.flatOptions })\n    const tree = await arb.loadActual()\n\n    const nodes = new Set()\n    for (const arg of args) {\n      for (const node of this.getNodes(tree, arg))\n        nodes.add(node)\n    }\n    if (nodes.size === 0)\n      throw `No dependencies found matching ${args.join(', ')}`\n\n    const expls = []\n    for (const node of nodes) {\n      const { extraneous, dev, optional, devOptional, peer, inBundle } = node\n      const expl = node.explain()\n      if (extraneous)\n        expl.extraneous = true\n      else {\n        expl.dev = dev\n        expl.optional = optional\n        expl.devOptional = devOptional\n        expl.peer = peer\n        expl.bundled = inBundle\n      }\n      expls.push(expl)\n    }\n\n    if (this.npm.flatOptions.json)\n      this.npm.output(JSON.stringify(expls, null, 2))\n    else {\n      this.npm.output(expls.map(expl => {\n        return explainNode(expl, Infinity, this.npm.color)\n      }).join('\\n\\n'))\n    }\n  }\n\n  getNodes (tree, arg) {\n    // if it's just a name, return packages by that name\n    const { validForOldPackages: valid } = validName(arg)\n    if (valid)\n      return tree.inventory.query('name', arg)\n\n    // if it's a location, get that node\n    const maybeLoc = arg.replace(/\\\\/g, '/').replace(/\\/+$/, '')\n    const nodeByLoc = tree.inventory.get(maybeLoc)\n    if (nodeByLoc)\n      return [nodeByLoc]\n\n    // maybe a path to a node_modules folder\n    const maybePath = relative(this.npm.prefix, resolve(maybeLoc))\n      .replace(/\\\\/g, '/').replace(/\\/+$/, '')\n    const nodeByPath = tree.inventory.get(maybePath)\n    if (nodeByPath)\n      return [nodeByPath]\n\n    // otherwise, try to select all matching nodes\n    try {\n      return this.getNodesByVersion(tree, arg)\n    } catch (er) {\n      return []\n    }\n  }\n\n  getNodesByVersion (tree, arg) {\n    const spec = npa(arg, this.npm.prefix)\n    if (spec.type !== 'version' && spec.type !== 'range')\n      return []\n\n    return tree.inventory.filter(node => {\n      return node.package.name === spec.name &&\n        semver.satisfies(node.package.version, spec.rawSpec)\n    })\n  }\n}\nmodule.exports = Explain\n"]},"metadata":{},"sourceType":"script"}