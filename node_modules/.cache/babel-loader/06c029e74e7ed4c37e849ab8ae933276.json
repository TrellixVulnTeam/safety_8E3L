{"ast":null,"code":"// npm view [pkg [pkg ...]]\nconst byteSize = require('byte-size');\n\nconst color = require('ansicolors');\n\nconst columns = require('cli-columns');\n\nconst fs = require('fs');\n\nconst jsonParse = require('json-parse-even-better-errors');\n\nconst log = require('npmlog');\n\nconst npa = require('npm-package-arg');\n\nconst {\n  resolve\n} = require('path');\n\nconst relativeDate = require('tiny-relative-date');\n\nconst semver = require('semver');\n\nconst style = require('ansistyles');\n\nconst {\n  inspect,\n  promisify\n} = require('util');\n\nconst {\n  packument\n} = require('pacote');\n\nconst getWorkspaces = require('./workspaces/get-workspaces.js');\n\nconst readFile = promisify(fs.readFile);\n\nconst readJson = async file => jsonParse(await readFile(file, 'utf8'));\n\nconst BaseCommand = require('./base-command.js');\n\nclass View extends BaseCommand {\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get description() {\n    return 'View registry info';\n  }\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n\n\n  static get params() {\n    return ['json', 'workspace', 'workspaces'];\n  }\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n\n\n  static get name() {\n    return 'view';\n  }\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n\n\n  static get usage() {\n    return ['[<@scope>/]<pkg>[@<version>] [<field>[.subfield]...]'];\n  }\n\n  async completion(opts) {\n    if (opts.conf.argv.remain.length <= 2) {\n      // There used to be registry completion here, but it stopped\n      // making sense somewhere around 50,000 packages on the registry\n      return;\n    } // have the package, get the fields\n\n\n    const config = { ...this.npm.flatOptions,\n      fullMetadata: true,\n      preferOnline: true\n    };\n    const spec = npa(opts.conf.argv.remain[2]);\n    const pckmnt = await packument(spec, config);\n    const defaultTag = this.npm.config.get('tag');\n    const dv = pckmnt.versions[pckmnt['dist-tags'][defaultTag]];\n    pckmnt.versions = Object.keys(pckmnt.versions).sort(semver.compareLoose);\n    return getFields(pckmnt).concat(getFields(dv));\n\n    function getFields(d, f, pref) {\n      f = f || [];\n      if (!d) return f;\n      pref = pref || [];\n      Object.keys(d).forEach(k => {\n        if (k.charAt(0) === '_' || k.indexOf('.') !== -1) return;\n        const p = pref.concat(k).join('.');\n        f.push(p);\n\n        if (Array.isArray(d[k])) {\n          d[k].forEach((val, i) => {\n            const pi = p + '[' + i + ']';\n            if (val && typeof val === 'object') getFields(val, f, [p]);else f.push(pi);\n          });\n          return;\n        }\n\n        if (typeof d[k] === 'object') getFields(d[k], f, [p]);\n      });\n      return f;\n    }\n  }\n\n  exec(args, cb) {\n    this.view(args).then(() => cb()).catch(cb);\n  }\n\n  execWorkspaces(args, filters, cb) {\n    this.viewWorkspaces(args, filters).then(() => cb()).catch(cb);\n  }\n\n  async view(args) {\n    if (!args.length) args = ['.'];\n    let pkg = args.shift();\n    const local = /^\\.@/.test(pkg) || pkg === '.';\n\n    if (local) {\n      if (this.npm.config.get('global')) throw new Error('Cannot use view command in global mode.');\n      const dir = this.npm.prefix;\n      const manifest = await readJson(resolve(dir, 'package.json'));\n      if (!manifest.name) throw new Error('Invalid package.json, no \"name\" field'); // put the version back if it existed\n\n      pkg = `${manifest.name}${pkg.slice(1)}`;\n    }\n\n    let wholePackument = false;\n\n    if (!args.length) {\n      args = [''];\n      wholePackument = true;\n    }\n\n    const [pckmnt, data] = await this.getData(pkg, args);\n\n    if (!this.npm.config.get('json') && wholePackument) {\n      // pretty view (entire packument)\n      data.map(v => this.prettyView(pckmnt, v[Object.keys(v)[0]]['']));\n    } else {\n      // JSON formatted output (JSON or specific attributes from packument)\n      let reducedData = data.reduce(reducer, {});\n\n      if (wholePackument) {\n        // No attributes\n        reducedData = cleanBlanks(reducedData);\n        log.silly('view', reducedData);\n      } // disable the progress bar entirely, as we can't meaningfully update it\n      // if we may have partial lines printed.\n\n\n      log.disableProgress();\n      const msg = await this.jsonData(reducedData, pckmnt._id);\n      if (msg !== '') console.log(msg);\n    }\n  }\n\n  async viewWorkspaces(args, filters) {\n    if (!args.length) args = ['.'];\n    const pkg = args.shift();\n    const local = /^\\.@/.test(pkg) || pkg === '.';\n\n    if (!local) {\n      this.npm.log.warn('Ignoring workspaces for specified package(s)');\n      return this.view([pkg, ...args]);\n    }\n\n    let wholePackument = false;\n\n    if (!args.length) {\n      wholePackument = true;\n      args = ['']; // getData relies on this\n    }\n\n    const results = {};\n    const workspaces = await getWorkspaces(filters, {\n      path: this.npm.localPrefix\n    });\n\n    for (const workspace of [...workspaces.entries()]) {\n      const wsPkg = `${workspace[0]}${pkg.slice(1)}`;\n      const [pckmnt, data] = await this.getData(wsPkg, args);\n      let reducedData = data.reduce(reducer, {});\n\n      if (wholePackument) {\n        // No attributes\n        reducedData = cleanBlanks(reducedData);\n        log.silly('view', reducedData);\n      }\n\n      if (!this.npm.config.get('json')) {\n        if (wholePackument) data.map(v => this.prettyView(pckmnt, v[Object.keys(v)[0]]['']));else {\n          console.log(`${workspace[0]}:`);\n          const msg = await this.jsonData(reducedData, pckmnt._id);\n          if (msg !== '') console.log(msg);\n        }\n      } else {\n        const msg = await this.jsonData(reducedData, pckmnt._id);\n        if (msg !== '') results[workspace[0]] = JSON.parse(msg);\n      }\n    }\n\n    if (Object.keys(results).length > 0) console.log(JSON.stringify(results, null, 2));\n  }\n\n  async getData(pkg, args) {\n    const opts = { ...this.npm.flatOptions,\n      preferOnline: true,\n      fullMetadata: true\n    };\n    const spec = npa(pkg); // get the data about this package\n\n    let version = spec.rawSpec || this.npm.config.get('tag');\n    const pckmnt = await packument(spec, opts);\n    if (pckmnt['dist-tags'] && pckmnt['dist-tags'][version]) version = pckmnt['dist-tags'][version];\n\n    if (pckmnt.time && pckmnt.time.unpublished) {\n      const u = pckmnt.time.unpublished;\n      const er = new Error('Unpublished by ' + u.name + ' on ' + u.time);\n      er.statusCode = 404;\n      er.code = 'E404';\n      er.pkgid = pckmnt._id;\n      throw er;\n    }\n\n    const data = [];\n    const versions = pckmnt.versions || {};\n    pckmnt.versions = Object.keys(versions).sort(semver.compareLoose); // remove readme unless we asked for it\n\n    if (args.indexOf('readme') === -1) delete pckmnt.readme;\n    Object.keys(versions).forEach(v => {\n      if (semver.satisfies(v, version, true)) {\n        args.forEach(arg => {\n          // remove readme unless we asked for it\n          if (args.indexOf('readme') !== -1) delete versions[v].readme;\n          data.push(showFields(pckmnt, versions[v], arg));\n        });\n      }\n    });\n    if (!this.npm.config.get('json') && args.length === 1 && args[0] === '') pckmnt.version = version;\n    return [pckmnt, data];\n  }\n\n  async jsonData(data, name) {\n    const versions = Object.keys(data);\n    let msg = '';\n    let msgJson = [];\n    const includeVersions = versions.length > 1;\n    let includeFields;\n    const json = this.npm.config.get('json');\n    versions.forEach(v => {\n      const fields = Object.keys(data[v]);\n      includeFields = includeFields || fields.length > 1;\n      if (json) msgJson.push({});\n      fields.forEach(f => {\n        let d = cleanup(data[v][f]);\n        if (fields.length === 1 && json) msgJson[msgJson.length - 1][f] = d;\n\n        if (includeVersions || includeFields || typeof d !== 'string') {\n          if (json) msgJson[msgJson.length - 1][f] = d;else {\n            d = inspect(d, {\n              showHidden: false,\n              depth: 5,\n              colors: this.npm.color,\n              maxArrayLength: null\n            });\n          }\n        } else if (typeof d === 'string' && json) d = JSON.stringify(d);\n\n        if (!json) {\n          if (f && includeFields) f += ' = ';\n          msg += (includeVersions ? name + '@' + v + ' ' : '') + (includeFields ? f : '') + d + '\\n';\n        }\n      });\n    });\n\n    if (json) {\n      if (msgJson.length && Object.keys(msgJson[0]).length === 1) {\n        const k = Object.keys(msgJson[0])[0];\n        msgJson = msgJson.map(m => m[k]);\n      }\n\n      if (msgJson.length === 1) msg = JSON.stringify(msgJson[0], null, 2) + '\\n';else if (msgJson.length > 1) msg = JSON.stringify(msgJson, null, 2) + '\\n';\n    }\n\n    return msg.trim();\n  }\n\n  prettyView(packument, manifest) {\n    // More modern, pretty printing of default view\n    const unicode = this.npm.config.get('unicode');\n    const tags = [];\n    Object.keys(packument['dist-tags']).forEach(t => {\n      const version = packument['dist-tags'][t];\n      tags.push(`${style.bright(color.green(t))}: ${version}`);\n    });\n    const unpackedSize = manifest.dist.unpackedSize && byteSize(manifest.dist.unpackedSize);\n    const licenseField = manifest.license || 'Proprietary';\n    const info = {\n      name: color.green(manifest.name),\n      version: color.green(manifest.version),\n      bins: Object.keys(manifest.bin || {}).map(color.yellow),\n      versions: color.yellow(packument.versions.length + ''),\n      description: manifest.description,\n      deprecated: manifest.deprecated,\n      keywords: (packument.keywords || []).map(color.yellow),\n      license: typeof licenseField === 'string' ? licenseField : licenseField.type || 'Proprietary',\n      deps: Object.keys(manifest.dependencies || {}).map(dep => {\n        return `${color.yellow(dep)}: ${manifest.dependencies[dep]}`;\n      }),\n      publisher: manifest._npmUser && unparsePerson({\n        name: color.yellow(manifest._npmUser.name),\n        email: color.cyan(manifest._npmUser.email)\n      }),\n      modified: !packument.time ? undefined : color.yellow(relativeDate(packument.time[packument.version])),\n      maintainers: (packument.maintainers || []).map(u => unparsePerson({\n        name: color.yellow(u.name),\n        email: color.cyan(u.email)\n      })),\n      repo: manifest.bugs && (manifest.bugs.url || manifest.bugs) || manifest.repository && (manifest.repository.url || manifest.repository),\n      site: manifest.homepage && (manifest.homepage.url || manifest.homepage),\n      tags,\n      tarball: color.cyan(manifest.dist.tarball),\n      shasum: color.yellow(manifest.dist.shasum),\n      integrity: manifest.dist.integrity && color.yellow(manifest.dist.integrity),\n      fileCount: manifest.dist.fileCount && color.yellow(manifest.dist.fileCount),\n      unpackedSize: unpackedSize && color.yellow(unpackedSize.value) + ' ' + unpackedSize.unit\n    };\n    if (info.license.toLowerCase().trim() === 'proprietary') info.license = style.bright(color.red(info.license));else info.license = color.green(info.license);\n    console.log('');\n    console.log(style.underline(style.bright(`${info.name}@${info.version}`)) + ' | ' + info.license + ' | deps: ' + (info.deps.length ? color.cyan(info.deps.length) : color.green('none')) + ' | versions: ' + info.versions);\n    info.description && console.log(info.description);\n    if (info.repo || info.site) info.site && console.log(color.cyan(info.site));\n    const warningSign = unicode ? ' ⚠️ ' : '!!';\n    info.deprecated && console.log(`\\n${style.bright(color.red('DEPRECATED'))}${warningSign} - ${info.deprecated}`);\n\n    if (info.keywords.length) {\n      console.log('');\n      console.log('keywords:', info.keywords.join(', '));\n    }\n\n    if (info.bins.length) {\n      console.log('');\n      console.log('bin:', info.bins.join(', '));\n    }\n\n    console.log('');\n    console.log('dist');\n    console.log('.tarball:', info.tarball);\n    console.log('.shasum:', info.shasum);\n    info.integrity && console.log('.integrity:', info.integrity);\n    info.unpackedSize && console.log('.unpackedSize:', info.unpackedSize);\n    const maxDeps = 24;\n\n    if (info.deps.length) {\n      console.log('');\n      console.log('dependencies:');\n      console.log(columns(info.deps.slice(0, maxDeps), {\n        padding: 1\n      }));\n      if (info.deps.length > maxDeps) console.log(`(...and ${info.deps.length - maxDeps} more.)`);\n    }\n\n    if (info.maintainers && info.maintainers.length) {\n      console.log('');\n      console.log('maintainers:');\n      info.maintainers.forEach(u => console.log('-', u));\n    }\n\n    console.log('');\n    console.log('dist-tags:');\n    console.log(columns(info.tags));\n\n    if (info.publisher || info.modified) {\n      let publishInfo = 'published';\n      if (info.modified) publishInfo += ` ${info.modified}`;\n      if (info.publisher) publishInfo += ` by ${info.publisher}`;\n      console.log('');\n      console.log(publishInfo);\n    }\n  }\n\n}\n\nmodule.exports = View;\n\nfunction cleanBlanks(obj) {\n  const clean = {};\n  Object.keys(obj).forEach(version => {\n    clean[version] = obj[version][''];\n  });\n  return clean;\n} // takes an array of objects and merges them into one object\n\n\nfunction reducer(acc, cur) {\n  if (cur) {\n    Object.keys(cur).forEach(v => {\n      acc[v] = acc[v] || {};\n      Object.keys(cur[v]).forEach(t => {\n        acc[v][t] = cur[v][t];\n      });\n    });\n  }\n\n  return acc;\n} // return whatever was printed\n\n\nfunction showFields(data, version, fields) {\n  const o = {};\n  [data, version].forEach(s => {\n    Object.keys(s).forEach(k => {\n      o[k] = s[k];\n    });\n  });\n  return search(o, fields.split('.'), version.version, fields);\n}\n\nfunction search(data, fields, version, title) {\n  let field;\n  const tail = fields;\n\n  while (!field && fields.length) field = tail.shift();\n\n  fields = [field].concat(tail);\n  let o;\n\n  if (!field && !tail.length) {\n    o = {};\n    o[version] = {};\n    o[version][title] = data;\n    return o;\n  }\n\n  let index = field.match(/(.+)\\[([^\\]]+)\\]$/);\n\n  if (index) {\n    field = index[1];\n    index = index[2];\n    if (data[field] && data[field][index]) return search(data[field][index], tail, version, title);else field = field + '[' + index + ']';\n  }\n\n  if (Array.isArray(data)) {\n    if (data.length === 1) return search(data[0], fields, version, title);\n    let results = [];\n    data.forEach((data, i) => {\n      const tl = title.length;\n      const newt = title.substr(0, tl - fields.join('.').length - 1) + '[' + i + ']' + [''].concat(fields).join('.');\n      results.push(search(data, fields.slice(), version, newt));\n    });\n    results = results.reduce(reducer, {});\n    return results;\n  }\n\n  if (!data[field]) return undefined;\n  data = data[field];\n\n  if (tail.length) {\n    // there are more fields to deal with.\n    return search(data, tail, version, title);\n  }\n\n  o = {};\n  o[version] = {};\n  o[version][title] = data;\n  return o;\n}\n\nfunction cleanup(data) {\n  if (Array.isArray(data)) return data.map(cleanup);\n  if (!data || typeof data !== 'object') return data;\n  const keys = Object.keys(data);\n  if (keys.length <= 3 && data.name && (keys.length === 1 || keys.length === 3 && data.email && data.url || keys.length === 2 && (data.email || data.url))) data = unparsePerson(data);\n  return data;\n}\n\nfunction unparsePerson(d) {\n  return d.name + (d.email ? ' <' + d.email + '>' : '') + (d.url ? ' (' + d.url + ')' : '');\n}","map":{"version":3,"sources":["/Users/kaelen/nsc-mds/node_modules/npm/lib/view.js"],"names":["byteSize","require","color","columns","fs","jsonParse","log","npa","resolve","relativeDate","semver","style","inspect","promisify","packument","getWorkspaces","readFile","readJson","file","BaseCommand","View","description","params","name","usage","completion","opts","conf","argv","remain","length","config","npm","flatOptions","fullMetadata","preferOnline","spec","pckmnt","defaultTag","get","dv","versions","Object","keys","sort","compareLoose","getFields","concat","d","f","pref","forEach","k","charAt","indexOf","p","join","push","Array","isArray","val","i","pi","exec","args","cb","view","then","catch","execWorkspaces","filters","viewWorkspaces","pkg","shift","local","test","Error","dir","prefix","manifest","slice","wholePackument","data","getData","map","v","prettyView","reducedData","reduce","reducer","cleanBlanks","silly","disableProgress","msg","jsonData","_id","console","warn","results","workspaces","path","localPrefix","workspace","entries","wsPkg","JSON","parse","stringify","version","rawSpec","time","unpublished","u","er","statusCode","code","pkgid","readme","satisfies","arg","showFields","msgJson","includeVersions","includeFields","json","fields","cleanup","showHidden","depth","colors","maxArrayLength","m","trim","unicode","tags","t","bright","green","unpackedSize","dist","licenseField","license","info","bins","bin","yellow","deprecated","keywords","type","deps","dependencies","dep","publisher","_npmUser","unparsePerson","email","cyan","modified","undefined","maintainers","repo","bugs","url","repository","site","homepage","tarball","shasum","integrity","fileCount","value","unit","toLowerCase","red","underline","warningSign","maxDeps","padding","publishInfo","module","exports","obj","clean","acc","cur","o","s","search","split","title","field","tail","index","match","tl","newt","substr"],"mappings":"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","sourcesContent":["// npm view [pkg [pkg ...]]\n\nconst byteSize = require('byte-size')\nconst color = require('ansicolors')\nconst columns = require('cli-columns')\nconst fs = require('fs')\nconst jsonParse = require('json-parse-even-better-errors')\nconst log = require('npmlog')\nconst npa = require('npm-package-arg')\nconst { resolve } = require('path')\nconst relativeDate = require('tiny-relative-date')\nconst semver = require('semver')\nconst style = require('ansistyles')\nconst { inspect, promisify } = require('util')\nconst { packument } = require('pacote')\nconst getWorkspaces = require('./workspaces/get-workspaces.js')\n\nconst readFile = promisify(fs.readFile)\nconst readJson = async file => jsonParse(await readFile(file, 'utf8'))\n\nconst BaseCommand = require('./base-command.js')\nclass View extends BaseCommand {\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get description () {\n    return 'View registry info'\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get params () {\n    return [\n      'json',\n      'workspace',\n      'workspaces',\n    ]\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get name () {\n    return 'view'\n  }\n\n  /* istanbul ignore next - see test/lib/load-all-commands.js */\n  static get usage () {\n    return ['[<@scope>/]<pkg>[@<version>] [<field>[.subfield]...]']\n  }\n\n  async completion (opts) {\n    if (opts.conf.argv.remain.length <= 2) {\n      // There used to be registry completion here, but it stopped\n      // making sense somewhere around 50,000 packages on the registry\n      return\n    }\n    // have the package, get the fields\n    const config = {\n      ...this.npm.flatOptions,\n      fullMetadata: true,\n      preferOnline: true,\n    }\n    const spec = npa(opts.conf.argv.remain[2])\n    const pckmnt = await packument(spec, config)\n    const defaultTag = this.npm.config.get('tag')\n    const dv = pckmnt.versions[pckmnt['dist-tags'][defaultTag]]\n    pckmnt.versions = Object.keys(pckmnt.versions).sort(semver.compareLoose)\n\n    return getFields(pckmnt).concat(getFields(dv))\n\n    function getFields (d, f, pref) {\n      f = f || []\n      if (!d)\n        return f\n      pref = pref || []\n      Object.keys(d).forEach((k) => {\n        if (k.charAt(0) === '_' || k.indexOf('.') !== -1)\n          return\n        const p = pref.concat(k).join('.')\n        f.push(p)\n        if (Array.isArray(d[k])) {\n          d[k].forEach((val, i) => {\n            const pi = p + '[' + i + ']'\n            if (val && typeof val === 'object')\n              getFields(val, f, [p])\n            else\n              f.push(pi)\n          })\n          return\n        }\n        if (typeof d[k] === 'object')\n          getFields(d[k], f, [p])\n      })\n      return f\n    }\n  }\n\n  exec (args, cb) {\n    this.view(args).then(() => cb()).catch(cb)\n  }\n\n  execWorkspaces (args, filters, cb) {\n    this.viewWorkspaces(args, filters).then(() => cb()).catch(cb)\n  }\n\n  async view (args) {\n    if (!args.length)\n      args = ['.']\n    let pkg = args.shift()\n    const local = /^\\.@/.test(pkg) || pkg === '.'\n\n    if (local) {\n      if (this.npm.config.get('global'))\n        throw new Error('Cannot use view command in global mode.')\n      const dir = this.npm.prefix\n      const manifest = await readJson(resolve(dir, 'package.json'))\n      if (!manifest.name)\n        throw new Error('Invalid package.json, no \"name\" field')\n      // put the version back if it existed\n      pkg = `${manifest.name}${pkg.slice(1)}`\n    }\n    let wholePackument = false\n    if (!args.length) {\n      args = ['']\n      wholePackument = true\n    }\n    const [pckmnt, data] = await this.getData(pkg, args)\n\n    if (!this.npm.config.get('json') && wholePackument) {\n      // pretty view (entire packument)\n      data.map((v) => this.prettyView(pckmnt, v[Object.keys(v)[0]]['']))\n    } else {\n      // JSON formatted output (JSON or specific attributes from packument)\n      let reducedData = data.reduce(reducer, {})\n      if (wholePackument) {\n        // No attributes\n        reducedData = cleanBlanks(reducedData)\n        log.silly('view', reducedData)\n      }\n      // disable the progress bar entirely, as we can't meaningfully update it\n      // if we may have partial lines printed.\n      log.disableProgress()\n\n      const msg = await this.jsonData(reducedData, pckmnt._id)\n      if (msg !== '')\n        console.log(msg)\n    }\n  }\n\n  async viewWorkspaces (args, filters) {\n    if (!args.length)\n      args = ['.']\n\n    const pkg = args.shift()\n\n    const local = /^\\.@/.test(pkg) || pkg === '.'\n    if (!local) {\n      this.npm.log.warn('Ignoring workspaces for specified package(s)')\n      return this.view([pkg, ...args])\n    }\n    let wholePackument = false\n    if (!args.length) {\n      wholePackument = true\n      args = [''] // getData relies on this\n    }\n    const results = {}\n    const workspaces =\n      await getWorkspaces(filters, { path: this.npm.localPrefix })\n    for (const workspace of [...workspaces.entries()]) {\n      const wsPkg = `${workspace[0]}${pkg.slice(1)}`\n      const [pckmnt, data] = await this.getData(wsPkg, args)\n\n      let reducedData = data.reduce(reducer, {})\n      if (wholePackument) {\n        // No attributes\n        reducedData = cleanBlanks(reducedData)\n        log.silly('view', reducedData)\n      }\n\n      if (!this.npm.config.get('json')) {\n        if (wholePackument)\n          data.map((v) => this.prettyView(pckmnt, v[Object.keys(v)[0]]['']))\n        else {\n          console.log(`${workspace[0]}:`)\n          const msg = await this.jsonData(reducedData, pckmnt._id)\n          if (msg !== '')\n            console.log(msg)\n        }\n      } else {\n        const msg = await this.jsonData(reducedData, pckmnt._id)\n        if (msg !== '')\n          results[workspace[0]] = JSON.parse(msg)\n      }\n    }\n    if (Object.keys(results).length > 0)\n      console.log(JSON.stringify(results, null, 2))\n  }\n\n  async getData (pkg, args) {\n    const opts = {\n      ...this.npm.flatOptions,\n      preferOnline: true,\n      fullMetadata: true,\n    }\n\n    const spec = npa(pkg)\n\n    // get the data about this package\n    let version = spec.rawSpec || this.npm.config.get('tag')\n\n    const pckmnt = await packument(spec, opts)\n\n    if (pckmnt['dist-tags'] && pckmnt['dist-tags'][version])\n      version = pckmnt['dist-tags'][version]\n\n    if (pckmnt.time && pckmnt.time.unpublished) {\n      const u = pckmnt.time.unpublished\n      const er = new Error('Unpublished by ' + u.name + ' on ' + u.time)\n      er.statusCode = 404\n      er.code = 'E404'\n      er.pkgid = pckmnt._id\n      throw er\n    }\n\n    const data = []\n    const versions = pckmnt.versions || {}\n    pckmnt.versions = Object.keys(versions).sort(semver.compareLoose)\n\n    // remove readme unless we asked for it\n    if (args.indexOf('readme') === -1)\n      delete pckmnt.readme\n\n    Object.keys(versions).forEach((v) => {\n      if (semver.satisfies(v, version, true)) {\n        args.forEach(arg => {\n          // remove readme unless we asked for it\n          if (args.indexOf('readme') !== -1)\n            delete versions[v].readme\n\n          data.push(showFields(pckmnt, versions[v], arg))\n        })\n      }\n    })\n\n    if (\n      !this.npm.config.get('json') &&\n      args.length === 1 &&\n      args[0] === ''\n    )\n      pckmnt.version = version\n\n    return [pckmnt, data]\n  }\n\n  async jsonData (data, name) {\n    const versions = Object.keys(data)\n    let msg = ''\n    let msgJson = []\n    const includeVersions = versions.length > 1\n    let includeFields\n    const json = this.npm.config.get('json')\n\n    versions.forEach((v) => {\n      const fields = Object.keys(data[v])\n      includeFields = includeFields || (fields.length > 1)\n      if (json)\n        msgJson.push({})\n      fields.forEach((f) => {\n        let d = cleanup(data[v][f])\n        if (fields.length === 1 && json)\n          msgJson[msgJson.length - 1][f] = d\n\n        if (includeVersions || includeFields || typeof d !== 'string') {\n          if (json)\n            msgJson[msgJson.length - 1][f] = d\n          else {\n            d = inspect(d, {\n              showHidden: false,\n              depth: 5,\n              colors: this.npm.color,\n              maxArrayLength: null,\n            })\n          }\n        } else if (typeof d === 'string' && json)\n          d = JSON.stringify(d)\n\n        if (!json) {\n          if (f && includeFields)\n            f += ' = '\n          msg += (includeVersions ? name + '@' + v + ' ' : '') +\n            (includeFields ? f : '') + d + '\\n'\n        }\n      })\n    })\n\n    if (json) {\n      if (msgJson.length && Object.keys(msgJson[0]).length === 1) {\n        const k = Object.keys(msgJson[0])[0]\n        msgJson = msgJson.map(m => m[k])\n      }\n      if (msgJson.length === 1)\n        msg = JSON.stringify(msgJson[0], null, 2) + '\\n'\n      else if (msgJson.length > 1)\n        msg = JSON.stringify(msgJson, null, 2) + '\\n'\n    }\n\n    return msg.trim()\n  }\n\n  prettyView (packument, manifest) {\n    // More modern, pretty printing of default view\n    const unicode = this.npm.config.get('unicode')\n    const tags = []\n\n    Object.keys(packument['dist-tags']).forEach((t) => {\n      const version = packument['dist-tags'][t]\n      tags.push(`${style.bright(color.green(t))}: ${version}`)\n    })\n    const unpackedSize = manifest.dist.unpackedSize &&\n      byteSize(manifest.dist.unpackedSize)\n    const licenseField = manifest.license || 'Proprietary'\n    const info = {\n      name: color.green(manifest.name),\n      version: color.green(manifest.version),\n      bins: Object.keys(manifest.bin || {}).map(color.yellow),\n      versions: color.yellow(packument.versions.length + ''),\n      description: manifest.description,\n      deprecated: manifest.deprecated,\n      keywords: (packument.keywords || []).map(color.yellow),\n      license: typeof licenseField === 'string'\n        ? licenseField\n        : (licenseField.type || 'Proprietary'),\n      deps: Object.keys(manifest.dependencies || {}).map((dep) => {\n        return `${color.yellow(dep)}: ${manifest.dependencies[dep]}`\n      }),\n      publisher: manifest._npmUser && unparsePerson({\n        name: color.yellow(manifest._npmUser.name),\n        email: color.cyan(manifest._npmUser.email),\n      }),\n      modified: !packument.time ? undefined\n      : color.yellow(relativeDate(packument.time[packument.version])),\n      maintainers: (packument.maintainers || []).map((u) => unparsePerson({\n        name: color.yellow(u.name),\n        email: color.cyan(u.email),\n      })),\n      repo: (\n        manifest.bugs && (manifest.bugs.url || manifest.bugs)\n      ) || (\n        manifest.repository && (manifest.repository.url || manifest.repository)\n      ),\n      site: (\n        manifest.homepage && (manifest.homepage.url || manifest.homepage)\n      ),\n      tags,\n      tarball: color.cyan(manifest.dist.tarball),\n      shasum: color.yellow(manifest.dist.shasum),\n      integrity:\n        manifest.dist.integrity && color.yellow(manifest.dist.integrity),\n      fileCount:\n        manifest.dist.fileCount && color.yellow(manifest.dist.fileCount),\n      unpackedSize: unpackedSize && color.yellow(unpackedSize.value) + ' ' + unpackedSize.unit,\n    }\n    if (info.license.toLowerCase().trim() === 'proprietary')\n      info.license = style.bright(color.red(info.license))\n    else\n      info.license = color.green(info.license)\n\n    console.log('')\n    console.log(\n      style.underline(style.bright(`${info.name}@${info.version}`)) +\n      ' | ' + info.license +\n      ' | deps: ' + (info.deps.length ? color.cyan(info.deps.length) : color.green('none')) +\n      ' | versions: ' + info.versions\n    )\n    info.description && console.log(info.description)\n    if (info.repo || info.site)\n      info.site && console.log(color.cyan(info.site))\n\n    const warningSign = unicode ? ' ⚠️ ' : '!!'\n    info.deprecated && console.log(\n      `\\n${style.bright(color.red('DEPRECATED'))}${\n      warningSign\n    } - ${info.deprecated}`\n    )\n\n    if (info.keywords.length) {\n      console.log('')\n      console.log('keywords:', info.keywords.join(', '))\n    }\n\n    if (info.bins.length) {\n      console.log('')\n      console.log('bin:', info.bins.join(', '))\n    }\n\n    console.log('')\n    console.log('dist')\n    console.log('.tarball:', info.tarball)\n    console.log('.shasum:', info.shasum)\n    info.integrity && console.log('.integrity:', info.integrity)\n    info.unpackedSize && console.log('.unpackedSize:', info.unpackedSize)\n\n    const maxDeps = 24\n    if (info.deps.length) {\n      console.log('')\n      console.log('dependencies:')\n      console.log(columns(info.deps.slice(0, maxDeps), { padding: 1 }))\n      if (info.deps.length > maxDeps)\n        console.log(`(...and ${info.deps.length - maxDeps} more.)`)\n    }\n\n    if (info.maintainers && info.maintainers.length) {\n      console.log('')\n      console.log('maintainers:')\n      info.maintainers.forEach((u) => console.log('-', u))\n    }\n\n    console.log('')\n    console.log('dist-tags:')\n    console.log(columns(info.tags))\n\n    if (info.publisher || info.modified) {\n      let publishInfo = 'published'\n      if (info.modified)\n        publishInfo += ` ${info.modified}`\n      if (info.publisher)\n        publishInfo += ` by ${info.publisher}`\n      console.log('')\n      console.log(publishInfo)\n    }\n  }\n}\nmodule.exports = View\n\nfunction cleanBlanks (obj) {\n  const clean = {}\n  Object.keys(obj).forEach((version) => {\n    clean[version] = obj[version]['']\n  })\n  return clean\n}\n\n// takes an array of objects and merges them into one object\nfunction reducer (acc, cur) {\n  if (cur) {\n    Object.keys(cur).forEach((v) => {\n      acc[v] = acc[v] || {}\n      Object.keys(cur[v]).forEach((t) => {\n        acc[v][t] = cur[v][t]\n      })\n    })\n  }\n\n  return acc\n}\n\n// return whatever was printed\nfunction showFields (data, version, fields) {\n  const o = {}\n  ;[data, version].forEach((s) => {\n    Object.keys(s).forEach((k) => {\n      o[k] = s[k]\n    })\n  })\n  return search(o, fields.split('.'), version.version, fields)\n}\n\nfunction search (data, fields, version, title) {\n  let field\n  const tail = fields\n  while (!field && fields.length)\n    field = tail.shift()\n  fields = [field].concat(tail)\n  let o\n  if (!field && !tail.length) {\n    o = {}\n    o[version] = {}\n    o[version][title] = data\n    return o\n  }\n  let index = field.match(/(.+)\\[([^\\]]+)\\]$/)\n  if (index) {\n    field = index[1]\n    index = index[2]\n    if (data[field] && data[field][index])\n      return search(data[field][index], tail, version, title)\n    else\n      field = field + '[' + index + ']'\n  }\n  if (Array.isArray(data)) {\n    if (data.length === 1)\n      return search(data[0], fields, version, title)\n\n    let results = []\n    data.forEach((data, i) => {\n      const tl = title.length\n      const newt = title.substr(0, tl - fields.join('.').length - 1) +\n                 '[' + i + ']' + [''].concat(fields).join('.')\n      results.push(search(data, fields.slice(), version, newt))\n    })\n    results = results.reduce(reducer, {})\n    return results\n  }\n  if (!data[field])\n    return undefined\n  data = data[field]\n  if (tail.length) {\n    // there are more fields to deal with.\n    return search(data, tail, version, title)\n  }\n  o = {}\n  o[version] = {}\n  o[version][title] = data\n  return o\n}\n\nfunction cleanup (data) {\n  if (Array.isArray(data))\n    return data.map(cleanup)\n\n  if (!data || typeof data !== 'object')\n    return data\n\n  const keys = Object.keys(data)\n  if (keys.length <= 3 &&\n      data.name &&\n      (keys.length === 1 ||\n       (keys.length === 3 && data.email && data.url) ||\n       (keys.length === 2 && (data.email || data.url))))\n    data = unparsePerson(data)\n\n  return data\n}\n\nfunction unparsePerson (d) {\n  return d.name +\n    (d.email ? ' <' + d.email + '>' : '') +\n    (d.url ? ' (' + d.url + ')' : '')\n}\n"]},"metadata":{},"sourceType":"script"}